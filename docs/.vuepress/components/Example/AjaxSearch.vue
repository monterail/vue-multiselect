<template lang="html">
  <VueMultiselect
    v-model="selectedCountries"
    id="ajax"
    label="name"
    track-by="code"
    placeholder="Type to search"
    open-direction="bottom"
    :options="countries"
    :multiple="true"
    :searchable="true"
    :loading="isLoading"
    :internal-search="false"
    :clear-on-select="false"
    :close-on-select="false"
    :options-limit="300"
    :limit="3"
    :limit-text="limitText"
    :max-height="600"
    :show-no-results="true"
    :hide-selected="true"
    @search-change="asyncFind"
  >
    <span slot="noResult" slot-scope="props">
      Oops! No elements found. Consider changing the search query.
    </span>
  </VueMultiselect>
</template>

<script>
// import countries from '../../countries.json'
const countries = []

export function ajaxFindCountry (query) {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      const results = countries.filter((element, index, array) => {
        return element.name.toLowerCase().includes(query.toLowerCase())
      })
      resolve(results)
    }, 1000)
  })
}

export default {
  data () {
    return {
      selectedCountries: [],
      countries: [],
      isLoading: false
    }
  },
  methods: {
    limitText (count) {
      return `and ${count} other countries`
    },
    asyncFind (query) {
      this.isLoading = true
      ajaxFindCountry(query).then(response => {
        this.countries = response
        this.isLoading = false
      })
    },
    clearAll () {
      this.selectedCountries = []
    }
  }
}
</script>

<style lang="sass">
.multiselect__clear
  position: absolute
  right: 41px
  height: 40px
  width: 40px
  display: block
  cursor: pointer
  z-index: 3

  &:before,
  &:after
    content: ""
    display: block
    position: absolute
    width: 3px
    height: 16px
    background: #aaa
    top: 12px
    right: 4px

  &:before
    transform: rotate(45deg)

  &:after
    transform: rotate(-45deg)
</style>
